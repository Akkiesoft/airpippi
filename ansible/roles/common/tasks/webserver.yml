# いい方法が思いつかない
- name: install pear modules
  command: pear install {{ item }}
  with_items:
    - HTTP_Request2-2.2.0
    - HTTP_OAuth-0.3.1
  ignore_errors: yes
  become: yes

- name: set timezone to PHP
  lineinfile: >
    dest=/etc/php5/fpm/php.ini
    insertafter="; date.timezone ="
    line="date.timezone = Asia/Tokyo"
  notify: restart php5-fpm
  become: yes

- name: remove www-data from /etc/at.deny for timer control
  lineinfile: >
    dest=/etc/at.deny
    line="www-data"
    state=absent
  notify: restart atd
  become: yes

- name: copy nginx siteconfig
  template: >
    src=default.j2
    dest=/etc/nginx/sites-available/default
  notify: restart nginx
  become: yes

- name: create htpasswd file for airpippi api
  htpasswd: >
    path=/etc/nginx/airpippi_api.htpasswd
    name={{ airpippi_user }}
    password={{ airpippi_pass }}
    owner=root
    group=www-data
    mode=0640
  when:
    - airpippi_user is defined
    - airpippi_pass is defined
  become: yes

- name: copy config for avahi http service
  copy: >
    src=http.service
    dest=/etc/avahi/services/http.service
  notify: restart avahi-daemon
  become: yes
